
This document explores qualitative indicators from an *ActivityInfo* database
that is monitoring Ecuador.

```{r}
ICT <- tibble(
  Date = c("Nov 2013", "June 2015", "Sept 2016", "May 2017", "May 2019"),
  Quantity = c(141442, 1887857, 3380991, 4932977, 12174327),
  Select = c(30531, 745841, 1296548, 1809419, 7595829),
  `Single-line text` = c(NA, 85863, 191640, 265196, 2683945),
  `Multi-line text` = c(6309, 57128, 116184, 168599, 915948),
  `% of total data collected` = c("3.54%", "2.06%", "2.33%", "2.35%", "3.92%")
)

## replace NAs with 0
ICT[is.na(ICT)] <- 0

ICT %>%
  gt() %>%
  fmt_number(
    columns = vars(Quantity, Select, `Single-line text`, `Multi-line text`),
    decimals = 0,
    use_seps = T
  ) %>% 
  tab_header(
    title = md("Indicator count totals"),
    subtitle = sprintf("%s to %s", ICT$Date[1], ICT$Date[length(ICT$Date)])
  ) %>% 
  cols_align(
    align = "center",
    columns = names(ICT)
  )
```

<br>

```{r cumulative-plot}
ggplot(ICT, aes(reorder(Date, `Multi-line text`), `Multi-line text`)) +
  geom_bar(stat = "identity", fill = "#3fae29") +
  xlab(NULL) +
  ylab("Number of values") +
  labs(title = "Total Multi-line Text Entries Collected by Year (Cumulative)") +
  scale_y_continuous(labels = scales::comma) +
  theme_ecuador1()
```

<br>

```{r data-type-plot, warning=FALSE}
ICT.wide <- ICT %>% 
  select(-`% of total data collected`) %>% 
  gather(variable, value, -Date, Quantity, Select, `Single-line text`, `Multi-line text`) %>% 
  mutate(variable = as.factor(variable))

ggplot(ICT.wide, aes(reorder(Date, value), value, fill = variable)) +
  geom_bar(stat = "identity", position = position_stack(reverse = F)) +
  xlab(NULL) +
  ylab("Number of values") +
  labs(title = "Total Collected Data by Type (Cumulative)") +
  scale_y_continuous(labels = scales::comma) +
  theme_ecuador1() +
  theme(legend.title = element_blank()) +
  scale_fill_brewer(palette = "Set1")
```

From the perspective of *ActivityInfo*, it shows a clear need for new tools to
support analysis of qualitative data as the absolute volume of qualitative data
has increased by a factor of 150, and almost doubled as a relative share of all
data collected.

## Data preparation

This section gives some ideas how the raw data looks like. The data has been
extracted from *ActivityInfo* by using the *ActivityInfo API* and pre-processed
to make it ready for the analysis. The most of data extraction and cleaning are
done beforehand (please see `R/` folder in the repository especially take a
close look at `etl.R` and `etl-methods.R` files). If you want to download the
raw data, you must have an access for it, that can be done by sourcing the
`etl.R` file.

Here is a glimpse of the raw data below and basic explanations of the columns:
```{r, paged.print = FALSE}
peak.ft <- as.data.frame(head(form.table, 4))
peak.ft <- rbind(peak.ft, "...")
peak.ft
```

Some description about the nature of data:

+ `databaseId`: the internal ActivityInfo id for databases

+ `databaseName`: the name of databases visible to users

+ `folderId`: the internal ActivityInfo id for folders

+ `folderName`: the name of folders visible to users

+ `formId`: the internal ActivityInfo id for forms

+ `formName`: the name of forms visible to users

+ `subFormId`: the internal ActivityInfo id for the sub-forms where the records are kept

+ `subFormName`: the name of the sub-forms visible to users

+ `Month`: indicating month when a record is entered

+ `code`: Schema question code

+ `question`: Question label indicated by the code

+ `response`: Response given by users

+ `required`: A boolean value to check whether the question is required to complete.

+ `type`: internal type for the code. The available types in the data are 
`r unique(form.table$type)`.

+ `partnerName`: The name of reporting partners. The name of implementing
partners can be extracted from the data.

+ `canton`: The canton name of the record.

+ `province`: The province name of the record.

+ `description`: the description field further explaining what the question mean.
The cells are represented as `NA` when fields not exists or not applicable.

Please see 
[*ActivityInfo documentation*](http://help.activityinfo.org/m/quick_start_database_design/c/240396)
for more information to see how the information is structured.

<hr>

