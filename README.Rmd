---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(DiagrammeR)
library(DiagrammeRsvg)
library(rsvg)
```

# QualMiner

Exploring qualitative indicators via text mining methods.

This repository contains the analysis code. The data used here can only be
accessed by using *ActivityInfo*.

### Main steps

In order to reproduce the code, follow the steps below:

#### 0. Authenticate

The call below authenticates the current user for the requests to get the data
from *ActivityInfo*. See [**Notes**](#notes) section for more details.

```{r, eval=FALSE}
activityinfo::activityInfoLogin()
```

#### 1. Retrieve data & ETL

Source `etl.R` file in the `R/` directory to pull the data from *ActivityInfo API* 
and process it to make it ready for analyses. At the end, a JSON file will
be saved in the `data/` directory.

#### 2. Analysis

Render RMarkdown files placed in the `/analysis` directory. For instance;

```{r, eval=FALSE}
path <- file.path("analysis", "april2019-response-quality.Rmd")
rmarkdown::render(path)
```

Rendering does not require any connection with the *ActivityInfo API* but the
JSON data file must exist in the `data/` directory.

### Process diagram
<!-- DIAGRAM START -->
```{r graph generation, include=FALSE}
script <- 'digraph diagram {
  graph [layout=dot]
  edge [decorate=true]
  rankdir=LR;

  // AI color codes:
  // #DBF1F1 (light turquoise)
  // #242934 (almost black)
	
	// OBJECTS:
	ActivityInfoSource [shape=cylinder, 
	                    label="ActivityInfo\nSource", 
	                    style=filled color="#242934" fillcolor="#DBF1F1"];
	MainData [shape=parallelogram, label="Data generated and loaded"];
	Analysis [shape=note, label="Analysis"]
	
	// ACTIONS:
	DataPulling [shape=rect, label="Pull data\nActivityInfo API"];
	ETL [shape=rect, label="ETL\ndata preparation"];
	
	// FLOW:
  {rank=same
	  ActivityInfoSource->DataPulling;
	}
	DataPulling->ETL;
	ETL->MainData;
	MainData->Analysis;
}'
graph <- DiagrammeR::grViz(script)
```
```{r svg to file, include=FALSE}
svg <- DiagrammeRsvg::export_svg(graph)
diagram.fname <- file.path("media", "diagram.png")
rsvg::rsvg_png(charToRaw(svg), diagram.fname)
```
```{r display, echo=FALSE, out.width = "95%"}
knitr::include_graphics(diagram.fname)
```
<!-- DIAGRAM END -->

### Notes

+ The data can be accessed with *ActivityInfo* API by using user credentials.
The [**ActivityInfo R Language Client**](https://github.com/bedatadriven/activityinfo-R)
provides a good documentation.

+ [**dplyr**](https://cran.r-project.org/package=dplyr) package is chosen as it is
useful for rapid ad-hoc analyses. The selected analysis code can be rewritten in
base R, which is proven to be more robust and stable for production
environments, towards the end of the project.

